# Per-listener-settings must be set before any listeners
# when listeners have different auth policies
per_listener_settings true

# --- Listener 1: Plain TCP (legacy devices, no auth) ---
listener 1883 0.0.0.0
allow_anonymous true

# --- Listener 2: TLS (new devices, auth required) ---
listener 8883 0.0.0.0
allow_anonymous false
password_file /mosquitto/config/passwd
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key
require_certificate false

# Persist retained messages and subscriptions across broker restarts
persistence true
persistence_location /mosquitto/data/
autosave_interval 300
